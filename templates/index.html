<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数字能量分析器</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background-color: #45a049;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .result-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ddd;
        }
        .result-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .loading {
            text-align: center;
            display: none;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .highlight {
            background-color: yellow;
            color: red;
            font-weight: bold;
        }
        /* 添加吉星和凶星的颜色样式 */
        .auspicious {
            color: blue;
            font-weight: bold;
        }
        .inauspicious {
            color: red;
            font-weight: bold;
        }
        .neutral {
            color: black;
            font-weight: bold;
        }
        .combination_analysis {
            color: #800080; /* 紫色 */
            font-weight: bold;
        }
        .special_combination {
            color: #008000; /* 绿色 */
            font-weight: bold;
        }
        .zero_effect {
            color: #808080; /* 灰色 */
            font-weight: bold;
        }
        .five_effect {
            color: #FFD700; /* 金色 */
            font-weight: bold;
        }
        .ending_warning {
            color: #FF4500; /* 橙红色 */
            font-weight: bold;
        }
        /* 添加输入提示 */
        .input-hint {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .explanation {
            background-color: #e8f4f8;
            border-left: 4px solid #2196F3;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>八星能量分析器</h1>
        <div class="input-group">
            <label for="input_str">请输入数字或字母：</label>
            <input type="text" id="input_str" name="input_str" placeholder="例如：13888888888 或 ABC123">
            <div class="input-hint">注意：程序将只分析输入内容的后六位数字</div>
        </div>
        <button onclick="findMatches()">查找匹配项</button>
        
        <div class="loading" id="loading">
            正在查找，请稍候...
        </div>
        
        <div class="results" id="results" style="display: none;">
            <h2>查询结果：</h2>
            <div id="results-content"></div>
        </div>
    </div>

    <script>
        async function findMatches() {
            const inputStr = document.getElementById('input_str').value;
            const loadingElement = document.getElementById('loading');
            const resultsElement = document.getElementById('results');
            const resultsContentElement = document.getElementById('results-content');
            
            if (!inputStr.trim()) {
                alert('请输入数字或字母');
                return;
            }
            
            // 显示加载状态
            loadingElement.style.display = 'block';
            resultsElement.style.display = 'none';
            
            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `phone_number=${encodeURIComponent(inputStr)}`
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    if (data.results && data.results.length > 0) {
                        // 格式化结果显示，保持顺序
                        let resultsHtml = '';
                        data.results.forEach(result => {
                            resultsHtml += `<div class="result-item">${formatResult(result)}</div>`;
                        });
                        resultsContentElement.innerHTML = resultsHtml;
                        resultsElement.style.display = 'block';
                    } else {
                        resultsContentElement.innerHTML = '<p>未找到匹配的结果。</p>';
                        resultsElement.style.display = 'block';
                    }
                } else {
                    resultsContentElement.innerHTML = `<p class="error">错误：${data.error || '未知错误'}</p>`;
                    resultsElement.style.display = 'block';
                }
            } catch (error) {
                resultsContentElement.innerHTML = `<p class="error">网络错误：${error.message}</p>`;
                resultsElement.style.display = 'block';
            } finally {
                loadingElement.style.display = 'none';
            }
        }
        
        function formatResult(result) {
            // 检查result是否为对象
            if (typeof result === 'object' && result !== null) {
                // 确保result有必要的属性
                if (!result.type) {
                    // 如果没有type属性，尝试安全地转换为字符串
                    try {
                        return JSON.stringify(result).replace(/\n/g, '<br>');
                    } catch (e) {
                        return '[无法显示的结果]';
                    }
                }
                
                const type = result.type;
                
                // 特殊处理不同类型的分析结果
                if (type === 'pair' && result.info && result.details) {
                    // 处理数字对分析结果
                    let html = '';
                    // 显示数字对
                    if (result.combination) {
                        html += `<div><strong>数字对: ${result.combination}</strong></div>`;
                    }
                    if (result.is_auspicious) {
                        html += `<div class="auspicious">${result.info.replace(/\n/g, '<br>')}</div>`;
                    } else if (result.is_inauspicious) {
                        html += `<div class="inauspicious">${result.info.replace(/\n/g, '<br>')}</div>`;
                    } else {
                        html += `<div class="neutral">${result.info.replace(/\n/g, '<br>')}</div>`;
                    }
                    html += `<div class="explanation">${result.details.replace(/\n/g, '<br>')}</div>`;
                    return html;
                } else if (type === 'special_combination' && result.explanation) {
                    // 处理特殊组合分析结果
                    let html = '';
                    // 显示组合
                    if (result.combination) {
                        html += `<div><strong>特殊组合: ${result.combination}</strong></div>`;
                    }
                    // 显示是哪两个数字对的组合
                    if (result.first_pair && result.second_pair) {
                        html += `<div>由数字对 ${result.first_pair} 和 ${result.second_pair} 组成</div>`;
                    }
                    html += `<div class="special_combination">${result.explanation.replace(/\n/g, '<br>')}</div>`;
                    return html;
                } else if (type === 'zero_effect' && result.position !== undefined && result.explanation) {
                    // 处理0的影响分析结果
                    return `<div class="zero_effect">数字"0"在位置${result.position}：${result.explanation.replace(/\n/g, '<br>')}</div>`;
                } else if (type === 'five_effect' && result.position !== undefined && result.explanation) {
                    // 处理5的影响分析结果
                    return `<div class="five_effect">数字"5"在位置${result.position}：${result.explanation.replace(/\n/g, '<br>')}</div>`;
                } else if (type === 'tail_analysis' && result.content) {
                    // 处理尾号分析结果
                    return `<div class="ending_warning">${result.content.replace(/\n/g, '<br>')}</div>`;
                } else if (result.content) {
                    // 默认处理方式，使用content属性
                    const lines = result.content.split('\n');
                    if (lines.length > 0) {
                        lines[0] = `<span class="${type}">${lines[0]}</span>`;
                    }
                    return lines.join('<br>');
                } else {
                    // 如果有type但没有content，尝试安全地显示其他属性
                    try {
                        let display = `<div class="${type}">类型: ${type}</div>`;
                        for (let key in result) {
                            if (key !== 'type' && result.hasOwnProperty(key)) {
                                display += `<div>${key}: ${String(result[key]).replace(/\n/g, '<br>')}</div>`;
                            }
                        }
                        return display;
                    } catch (e) {
                        return `<div class="${type}">类型: ${type}<br>[结果内容无法显示]</div>`;
                    }
                }
            } else {
                // 如果不是对象，按原来的方式处理
                return String(result).replace(/\n/g, '<br>');
            }
        }
        
        // 添加回车键支持
        document.getElementById('input_str').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                findMatches();
            }
        });
    </script>
</body>
</html>