from flask import Flask, render_template, request, jsonify
import os
import json

app = Flask(__name__)

# 八星能量数据，根据您提供的详细信息整理
data = {
    # 四大吉星
    # 天医 (财富、婚姻)
    '13': ['八星:天医(财富、婚姻),最强,阳刚\n优点：天生资质好，聪明，心地善良。财富磁场强大，容易吸引金钱，赚钱不费力，并且容易收获美好的爱情或步入婚姻。在事业上，因为聪明和财运，容易成为老板或行业专家。\n缺点：由于天性善良，有时会显得过于单纯，缺乏主见，容易轻信他人而受骗。他们对金钱没有太多概念，花钱时也比较大方。'],
    '31': ['八星:天医(财富、婚姻),最强,阳刚\n优点：天生资质好，聪明，心地善良。财富磁场强大，容易吸引金钱，赚钱不费力，并且容易收获美好的爱情或步入婚姻。在事业上，因为聪明和财运，容易成为老板或行业专家。\n缺点：由于天性善良，有时会显得过于单纯，缺乏主见，容易轻信他人而受骗。他们对金钱没有太多概念，花钱时也比较大方。'],
    '68': ['八星:天医(财富、婚姻),强,阳刚\n优点：天生资质好，聪明，心地善良。财富磁场强大，容易吸引金钱，赚钱不费力，并且容易收获美好的爱情或步入婚姻。在事业上，因为聪明和财运，容易成为老板或行业专家。\n缺点：由于天性善良，有时会显得过于单纯，缺乏主见，容易轻信他人而受骗。他们对金钱没有太多概念，花钱时也比较大方。'],
    '86': ['八星:天医(财富、婚姻),强,阳刚\n优点：天生资质好，聪明，心地善良。财富磁场强大，容易吸引金钱，赚钱不费力，并且容易收获美好的爱情或步入婚姻。在事业上，因为聪明和财运，容易成为老板或行业专家。\n缺点：由于天性善良，有时会显得过于单纯，缺乏主见，容易轻信他人而受骗。他们对金钱没有太多概念，花钱时也比较大方。'],
    '94': ['八星:天医(财富、婚姻),较弱，阴柔\n优点：天生资质好，聪明，心地善良。财富磁场强大，容易吸引金钱，赚钱不费力，并且容易收获美好的爱情或步入婚姻。在事业上，因为聪明和财运，容易成为老板或行业专家。\n缺点：由于天性善良，有时会显得过于单纯，缺乏主见，容易轻信他人而受骗。他们对金钱没有太多概念，花钱时也比较大方。'],
    '49': ['八星:天医(财富、婚姻),较弱，阴柔\n优点：天生资质好，聪明，心地善良。财富磁场强大，容易吸引金钱，赚钱不费力，并且容易收获美好的爱情或步入婚姻。在事业上，因为聪明和财运，容易成为老板或行业专家。\n缺点：由于天性善良，有时会显得过于单纯，缺乏主见，容易轻信他人而受骗。他们对金钱没有太多概念，花钱时也比较大方。'],
    '72': ['八星:天医(财富、婚姻),最弱，阴柔\n优点：天生资质好，聪明，心地善良。财富磁场强大，容易吸引金钱，赚钱不费力，并且容易收获美好的爱情或步入婚姻。在事业上，因为聪明和财运，容易成为老板或行业专家。\n缺点：由于天性善良，有时会显得过于单纯，缺乏主见，容易轻信他人而受骗。他们对金钱没有太多概念，花钱时也比较大方。'],
    '27': ['八星:天医(财富、婚姻),最弱，阴柔\n优点：天生资质好，聪明，心地善良。财富磁场强大，容易吸引金钱，赚钱不费力，并且容易收获美好的爱情或步入婚姻。在事业上，因为聪明和财运，容易成为老板或行业专家。\n缺点：由于天性善良，有时会显得过于单纯，缺乏主见，容易轻信他人而受骗。他们对金钱没有太多概念，花钱时也比较大方。'],
    
    # 生气 (贵人、人缘)
    '14': ['八星:生气(贵人、人缘),最强,阳刚\n优点：天性乐观，随和开朗，是天生的乐天派。拥有极佳的人缘，无论遇到什么困难，总有贵人出手相助，能够化险为夷。他们看待事情非常坦然，不计较，是团队中的"和事佬"。\n缺点：企图心和上进心不强，容易满足于现状，显得有些懒散和被动。在事业上缺乏冲劲，对目标追求不够执着。'],
    '41': ['八星:生气(贵人、人缘),最强,阳刚\n优点：天性乐观，随和开朗，是天生的乐天派。拥有极佳的人缘，无论遇到什么困难，总有贵人出手相助，能够化险为夷。他们看待事情非常坦然，不计较，是团队中的"和事佬"。\n缺点：企图心和上进心不强，容易满足于现状，显得有些懒散和被动。在事业上缺乏冲劲，对目标追求不够执着。'],
    '67': ['八星:生气(贵人、人缘),强,阳刚\n优点：天性乐观，随和开朗，是天生的乐天派。拥有极佳的人缘，无论遇到什么困难，总有贵人出手相助，能够化险为夷。他们看待事情非常坦然，不计较，是团队中的"和事佬"。\n缺点：企图心和上进心不强，容易满足于现状，显得有些懒散和被动。在事业上缺乏冲劲，对目标追求不够执着。'],
    '76': ['八星:生气(贵人、人缘),强,阳刚\n优点：天性乐观，随和开朗，是天生的乐天派。拥有极佳的人缘，无论遇到什么困难，总有贵人出手相助，能够化险为夷。他们看待事情非常坦然，不计较，是团队中的"和事佬"。\n缺点：企图心和上进心不强，容易满足于现状，显得有些懒散和被动。在事业上缺乏冲劲，对目标追求不够执着。'],
    '93': ['八星:生气(贵人、人缘),较弱，阴柔\n优点：天性乐观，随和开朗，是天生的乐天派。拥有极佳的人缘，无论遇到什么困难，总有贵人出手相助，能够化险为夷。他们看待事情非常坦然，不计较，是团队中的"和事佬"。\n缺点：企图心和上进心不强，容易满足于现状，显得有些懒散和被动。在事业上缺乏冲劲，对目标追求不够执着。'],
    '39': ['八星:生气(贵人、人缘),较弱，阴柔\n优点：天性乐观，随和开朗，是天生的乐天派。拥有极佳的人缘，无论遇到什么困难，总有贵人出手相助，能够化险为夷。他们看待事情非常坦然，不计较，是团队中的"和事佬"。\n缺点：企图心和上进心不强，容易满足于现状，显得有些懒散和被动。在事业上缺乏冲劲，对目标追求不够执着。'],
    '82': ['八星:生气(贵人、人缘),最弱，阴柔\n优点：天性乐观，随和开朗，是天生的乐天派。拥有极佳的人缘，无论遇到什么困难，总有贵人出手相助，能够化险为夷。他们看待事情非常坦然，不计较，是团队中的"和事佬"。\n缺点：企图心和上进心不强，容易满足于现状，显得有些懒散和被动。在事业上缺乏冲劲，对目标追求不够执着。'],
    '28': ['八星:生气(贵人、人缘),最弱，阴柔\n优点：天性乐观，随和开朗，是天生的乐天派。拥有极佳的人缘，无论遇到什么困难，总有贵人出手相助，能够化险为夷。他们看待事情非常坦然，不计较，是团队中的"和事佬"。\n缺点：企图心和上进心不强，容易满足于现状，显得有些懒散和被动。在事业上缺乏冲劲，对目标追求不够执着。'],
    
    # 延年 (事业、能力)
    '19': ['八星:延年(事业、能力),最强,阳刚\n优点：具有强大的领导力和责任感，是天生的大将之才。做事专业，意志坚定，有主见，能够独当一面。在理财方面懂得规划和节制，是懂得"守财"的类型。\n缺点：性格强势，好作主导，有时显得固执，听不进他人意见。工作压力大，容易劳心劳力，长期下来可能影响健康，特别是肩颈和心脏方面的问题。'],
    '91': ['八星:延年(事业、能力),最强,阳刚\n优点：具有强大的领导力和责任感，是天生的大将之才。做事专业，意志坚定，有主见，能够独当一面。在理财方面懂得规划和节制，是懂得"守财"的类型。\n缺点：性格强势，好作主导，有时显得固执，听不进他人意见。工作压力大，容易劳心劳力，长期下来可能影响健康，特别是肩颈和心脏方面的问题。'],
    '87': ['八星:延年(事业、能力),强,阳刚\n优点：具有强大的领导力和责任感，是天生的大将之才。做事专业，意志坚定，有主见，能够独当一面。在理财方面懂得规划和节制，是懂得"守财"的类型。\n缺点：性格强势，好作主导，有时显得固执，听不进他人意见。工作压力大，容易劳心劳力，长期下来可能影响健康，特别'],
    '78': ['八星:延年(事业、能力),强,阳刚\n优点：具有强大的领导力和责任感，是天生的大将之才。做事专业，意志坚定，有主见，能够独当一面。在理财方面懂得规划和节制，是懂得"守财"的类型。\n缺点：性格强势，好作主导，有时显得固执，听不进他人意见。工作压力大，容易劳心劳力，长期下来可能影响健康，特别'],
    '43': ['八星:延年(事业、能力),较弱，阴柔\n优点：具有强大的领导力和责任感，是天生的大将之才。做事专业，意志坚定，有主见，能够独当一面。在理财方面懂得规划和节制，是懂得"守财"的类型。\n缺点：性格强势，好作主导，有时显得固执，听不进他人意见。工作压力大，容易劳心劳力，长期下来可能影响健康，特别'],
    '34': ['八星:延年(事业、能力),较弱，阴柔\n优点：具有强大的领导力和责任感，是天生的大将之才。做事专业，意志坚定，有主见，能够独当一面。在理财方面懂得规划和节制，是懂得"守财"的类型。\n缺点：性格强势，好作主导，有时显得固执，听不进他人意见。工作压力大，容易劳心劳力，长期下来可能影响健康，特别'],
    '26': ['八星:延年(事业、能力),最弱，阴柔\n优点：具有强大的领导力和责任感，是天生的大将之才。做事专业，意志坚定，有主见，能够独当一面。在理财方面懂得规划和节制，是懂得"守财"的类型。\n缺点：性格强势，好作主导，有时显得固执，听不进他人意见。工作压力大，容易劳心劳力，长期下来可能影响健康，特别'],
    '62': ['八星:延年(事业、能力),最弱，阴柔\n优点：具有强大的领导力和责任感，是天生的大将之才。做事专业，意志坚定，有主见，能够独当一面。在理财方面懂得规划和节制，是懂得"守财"的类型。\n缺点：性格强势，好作主导，有时显得固执，听不进他人意见。工作压力大，容易劳心劳力，长期下来可能影响健康，特别'],
    
    # 伏位 (稳定、忍耐)
    '11': ['八星:伏位(稳定、忍耐),最强,阳刚\n优点：有极强的耐心和毅力，做事谨慎，善于等待时机。他们能够卧薪尝胆，厚积薄发，适合从事需要长期坚持和研究的工作。\n缺点：性格偏于保守和被动，内心缺乏安全感，有时会因为过于犹豫而错失良机。事业和感情上容易陷入被动等待的局面，突破性不强，进展缓慢。'],
    '22': ['八星:伏位(稳定、忍耐),最强,阳刚\n优点：有极强的耐心和毅力，做事谨慎，善于等待时机。他们能够卧薪尝胆，厚积薄发，适合从事需要长期坚持和研究的工作。\n缺点：性格偏于保守和被动，内心缺乏安全感，有时会因为过于犹豫而错失良机。事业和感情上容易陷入被动等待的局面，突破性不强，进展缓慢。'],
    '99': ['八星:伏位(稳定、忍耐),强,阳刚\n优点：有极强的耐心和毅力，做事谨慎，善于等待时机。他们能够卧薪尝胆，厚积薄发，适合从事需要长期坚持和研究的工作。\n缺点：性格偏于保守和被动，内心缺乏安全感，有时会因为过于犹豫而错失良机。事业和感情上容易陷入被动等待的局面，突破性不强，进展缓慢。'],
    '88': ['八星:伏位(稳定、忍耐),强,阳刚\n优点：有极强的耐心和毅力，做事谨慎，善于等待时机。他们能够卧薪尝胆，厚积薄发，适合从事需要长期坚持和研究的工作。\n缺点：性格偏于保守和被动，内心缺乏安全感，有时会因为过于犹豫而错失良机。事业和感情上容易陷入被动等待的局面，突破性不强，进展缓慢。'],
    '77': ['八星:伏位(稳定、忍耐),较弱，阴柔\n优点：有极强的耐心和毅力，做事谨慎，善于等待时机。他们能够卧薪尝胆，厚积薄发，适合从事需要长期坚持和研究的工作。\n缺点：性格偏于保守和被动，内心缺乏安全感，有时会因为过于犹豫而错失良机。事业和感情上容易陷入被动等待的局面，突破性不强，进展缓慢。'],
    '66': ['八星:伏位(稳定、忍耐),较弱，阴柔\n优点：有极强的耐心和毅力，做事谨慎，善于等待时机。他们能够卧薪尝胆，厚积薄发，适合从事需要长期坚持和研究的工作。\n缺点：性格偏于保守和被动，内心缺乏安全感，有时会因为过于犹豫而错失良机。事业和感情上容易陷入被动等待的局面，突破性不强，进展缓慢。'],
    '44': ['八星:伏位(稳定、忍耐),最弱，阴柔\n优点：有极强的耐心和毅力，做事谨慎，善于等待时机。他们能够卧薪尝胆，厚积薄发，适合从事需要长期坚持和研究的工作。\n缺点：性格偏于保守和被动，内心缺乏安全感，有时会因为过于犹豫而错失良机。事业和感情上容易陷入被动等待的局面，突破性不强，进展缓慢。'],
    '33': ['八星:伏位(稳定、忍耐),最弱，阴柔\n优点：有极强的耐心和毅力，做事谨慎，善于等待时机。他们能够卧薪尝胆，厚积薄发，适合从事需要长期坚持和研究的工作。\n缺点：性格偏于保守和被动，内心缺乏安全感，有时会因为过于犹豫而错失良机。事业和感情上容易陷入被动等待的局面，突破性不强，进展缓慢。'],
    
    # 四大凶星
    # 绝命 (投资、极端)
    '12': ['八星:绝命(投资、极端),最强,阳刚\n优点：头脑反应快，敢于冒险和拼搏，在投资领域有独特的敏锐度和判断力，能够抓住机会赚取大笔财富。他们富有激情，做事果断。\n缺点：情绪和财运都极不稳定，大起大落。花钱如流水，不善于理财，容易导致负债。性格冲动，好胜心强，容易与人发生冲突，甚至引发官司。'],
    '21': ['八星:绝命(投资、极端),最强,阳刚\n优点：头脑反应快，敢于冒险和拼搏，在投资领域有独特的敏锐度和判断力，能够抓住机会赚取大笔财富。他们富有激情，做事果断。\n缺点：情绪和财运都极不稳定，大起大落。花钱如流水，不善于理财，容易导致负债。性格冲动，好胜心强，容易与人发生冲突，甚至引发官司。'],
    '69': ['八星:绝命(投资、极端),强,阳刚\n优点：头脑反应快，敢于冒险和拼搏，在投资领域有独特的敏锐度和判断力，能够抓住机会赚取大笔财富。他们富有激情，做事果断。\n缺点：情绪和财运都极不稳定，大起大落。花钱如流水，不善于理财，容易导致负债。性格冲动，好胜心强，容易与人发生冲突，甚至引发官司。'],
    '96': ['八星:绝命(投资、极端),强,阳刚\n优点：头脑反应快，敢于冒险和拼搏，在投资领域有独特的敏锐度和判断力，能够抓住机会赚取大笔财富。他们富有激情，做事果断。\n缺点：情绪和财运都极不稳定，大起大落。花钱如流水，不善于理财，容易导致负债。性格冲动，好胜心强，容易与人发生冲突，甚至引发官司。'],
    '84': ['八星:绝命(投资、极端),较弱，阴柔\n优点：头脑反应快，敢于冒险和拼搏，在投资领域有独特的敏锐度和判断力，能够抓住机会赚取大笔财富。他们富有激情，做事果断。\n缺点：情绪和财运都极不稳定，大起大落。花钱如流水，不善于理财，容易导致负债。性格冲动，好胜心强，容易与人发生冲突，甚至引发官司。'],
    '48': ['八星:绝命(投资、极端),较弱，阴柔\n优点：头脑反应快，敢于冒险和拼搏，在投资领域有独特的敏锐度和判断力，能够抓住机会赚取大笔财富。他们富有激情，做事果断。\n缺点：情绪和财运都极不稳定，大起大落。花钱如流水，不善于理财，容易导致负债。性格冲动，好胜心强，容易与人发生冲突，甚至引发官司。'],
    '73': ['八星:绝命(投资、极端),最弱，阴柔\n优点：头脑反应快，敢于冒险和拼搏，在投资领域有独特的敏锐度和判断力，能够抓住机会赚取大笔财富。他们富有激情，做事果断。\n缺点：情绪和财运都极不稳定，大起大落。花钱如流水，不善于理财，容易导致负债。性格冲动，好胜心强，容易与人发生冲突，甚至引发官司。'],
    '37': ['八星:绝命(投资、极端),最弱，阴柔\n优点：头脑反应快，敢于冒险和拼搏，在投资领域有独特的敏锐度和判断力，能够抓住机会赚取大笔财富。他们富有激情，做事果断。\n缺点：情绪和财运都极不稳定，大起大落。花钱如流水，不善于理财，容易导致负债。性格冲动，好胜心强，容易与人发生冲突，甚至引发官司。'],
    
    # 五鬼 (智慧、变动)
    '18': ['八星:五鬼(智慧、变动),最强,阳刚\n优点：才华横溢，思维敏捷，具有逆向思维和鬼才般的创造力，适合从事策划、设计、玄学等需要灵感的工作。容易获得偏财或暗财。\n缺点：性格多变，想法怪异，令人难以捉摸。缺乏安全感，容易吸引血光之灾或突发意外。感情上极不稳定，容易出现三角恋或瞬间分手的情况。'],
    '81': ['八星:五鬼(智慧、变动),最强,阳刚\n优点：才华横溢，思维敏捷，具有逆向思维和鬼才般的创造力，适合从事策划、设计、玄学等需要灵感的工作。容易获得偏财或暗财。\n缺点：性格多变，想法怪异，令人难以捉摸。缺乏安全感，容易吸引血光之灾或突发意外。感情上极不稳定，容易出现三角恋或瞬间分手的情况。'],
    '97': ['八星:五鬼(智慧、变动),强,阳刚\n优点：才华横溢，思维敏捷，具有逆向思维和鬼才般的创造力，适合从事策划、设计、玄学等需要灵感的工作。容易获得偏财或暗财。\n缺点：性格多变，想法怪异，令人难以捉摸。缺乏安全感，容易吸引血光之灾或突发意外。感情上极不稳定，容易出现三角恋或瞬间分手的情况。'],
    '79': ['八星:五鬼(智慧、变动),强,阳刚\n优点：才华横溢，思维敏捷，具有逆向思维和鬼才般的创造力，适合从事策划、设计、玄学等需要灵感的工作。容易获得偏财或暗财。\n缺点：性格多变，想法怪异，令人难以捉摸。缺乏安全感，容易吸引血光之灾或突发意外。感情上极不稳定，容易出现三角恋或瞬间分手的情况。'],
    '63': ['八星:五鬼(智慧、变动),较弱，阴柔\n优点：才华横溢，思维敏捷，具有逆向思维和鬼才般的创造力，适合从事策划、设计、玄学等需要灵感的工作。容易获得偏财或暗财。\n缺点：性格多变，想法怪异，令人难以捉摸。缺乏安全感，容易吸引血光之灾或突发意外。感情上极不稳定，容易出现三角恋或瞬间分手的情况。'],
    '36': ['八星:五鬼(智慧、变动),较弱，阴柔\n优点：才华横溢，思维敏捷，具有逆向思维和鬼才般的创造力，适合从事策划、设计、玄学等需要灵感的工作。容易获得偏财或暗财。\n缺点：性格多变，想法怪异，令人难以捉摸。缺乏安全感，容易吸引血光之灾或突发意外。感情上极不稳定，容易出现三角恋或瞬间分手的情况。'],
    '42': ['八星:五鬼(智慧、变动),最弱，阴柔\n优点：才华横溢，思维敏捷，具有逆向思维和鬼才般的创造力，适合从事策划、设计、玄学等需要灵感的工作。容易获得偏财或暗财。\n缺点：性格多变，想法怪异，令人难以捉摸。缺乏安全感，容易吸引血光之灾或突发意外。感情上极不稳定，容易出现三角恋或瞬间分手的情况。'],
    '24': ['八星:五鬼(智慧、变动),最弱，阴柔\n优点：才华横溢，思维敏捷，具有逆向思维和鬼才般的创造力，适合从事策划、设计、玄学等需要灵感的工作。容易获得偏财或暗财。\n缺点：性格多变，想法怪异，令人难以捉摸。缺乏安全感，容易吸引血光之灾或突发意外。感情上极不稳定，容易出现三角恋或瞬间分手的情况。'],
    
    # 祸害 (口才、是非)
    '17': ['八星:祸害(口才、是非),最强,阳刚\n优点：能言善辩，口才极佳，非常适合从事以口为业的工作，如销售、讲师、律师、主持人等。\n缺点：脾气暴躁，说话直接，容易因言语得罪人。爱面子，好胜心强，喜欢与人争辩，容易招惹小人和口舌是非。健康上易有气管、喉咙或免疫系统方面的问题。'],
    '71': ['八星:祸害(口才、是非),最强,阳刚\n优点：能言善辩，口才极佳，非常适合从事以口为业的工作，如销售、讲师、律师、主持人等。\n缺点：脾气暴躁，说话直接，容易因言语得罪人。爱面子，好胜心强，喜欢与人争辩，容易招惹小人和口舌是非。健康上易有气管、喉咙或免疫系统方面的问题。'],
    '98': ['八星:祸害(口才、是非),强,阳刚\n优点：能言善辩，口才极佳，非常适合从事以口为业的工作，如销售、讲师、律师、主持人等。\n缺点：脾气暴躁，说话直接，容易因言语得罪人。爱面子，好胜心强，喜欢与人争辩，容易招惹小人和口舌是非。健康上易有气管、喉咙或免疫系统方面的问题。'],
    '89': ['八星:祸害(口才、是非),强,阳刚\n优点：能言善辩，口才极佳，非常适合从事以口为业的工作，如销售、讲师、律师、主持人等。\n缺点：脾气暴躁，说话直接，容易因言语得罪人。爱面子，好胜心强，喜欢与人争辩，容易招惹小人和口舌是非。健康上易有气管、喉咙或免疫系统方面的问题。'],
    '64': ['八星:祸害(口才、是非),较弱，阴柔\n优点：能言善辩，口才极佳，非常适合从事以口为业的工作，如销售、讲师、律师、主持人等。\n缺点：脾气暴躁，说话直接，容易因言语得罪人。爱面子，好胜心强，喜欢与人争辩，容易招惹小人和口舌是非。健康上易有气管、喉咙或免疫系统方面的问题。'],
    '46': ['八星:祸害(口才、是非),较弱，阴柔\n优点：能言善辩，口才极佳，非常适合从事以口为业的工作，如销售、讲师、律师、主持人等。\n缺点：脾气暴躁，说话直接，容易因言语得罪人。爱面子，好胜心强，喜欢与人争辩，容易招惹小人和口舌是非。健康上易有气管、喉咙或免疫系统方面的问题。'],
    '32': ['八星:祸害(口才、是非),最弱，阴柔\n优点：能言善辩，口才极佳，非常适合从事以口为业的工作，如销售、讲师、律师、主持人等。\n缺点：脾气暴躁，说话直接，容易因言语得罪人。爱面子，好胜心强，喜欢与人争辩，容易招惹小人和口舌是非。健康上易有气管、喉咙或免疫系统方面的问题。'],
    '23': ['八星:祸害(口才、是非),最弱，阴柔\n优点：能言善辩，口才极佳，非常适合从事以口为业的工作，如销售、讲师、律师、主持人等。\n缺点：脾气暴躁，说话直接，容易因言语得罪人。爱面子，好胜心强，喜欢与人争辩，容易招惹小人和口舌是非。健康上易有气管、喉咙或免疫系统方面的问题。'],
    
    # 六煞 (情感、人际)
    '16': ['八星:六煞(情感、人际),最强,阳刚\n优点：外表富有魅力，善于交际，懂得变通，在处理人际关系方面非常圆融。异性缘极佳，适合在服务业、公关或与美相关的行业发展。\n缺点：情感丰富但脆弱，容易为情所困，情绪起伏大，易产生忧郁情绪。由于异性缘太好，容易陷入不健康的感情纠葛（偏桃花），导致情感和家庭生活不稳定。'],
    '61': ['八星:六煞(情感、人际),最强,阳刚\n优点：外表富有魅力，善于交际，懂得变通，在处理人际关系方面非常圆融。异性缘极佳，适合在服务业、公关或与美相关的行业发展。\n缺点：情感丰富但脆弱，容易为情所困，情绪起伏大，易产生忧郁情绪。由于异性缘太好，容易陷入不健康的感情纠葛（偏桃花），导致情感和家庭生活不稳定。'],
    '74': ['八星:六煞(情感、人际),强,阳刚\n优点：外表富有魅力，善于交际，懂得变通，在处理人际关系方面非常圆融。异性缘极佳，适合在服务业、公关或与美相关的行业发展。\n缺点：情感丰富但脆弱，容易为情所困，情绪起伏大，易产生忧郁情绪。由于异性缘太好，容易陷入不健康的感情纠葛（偏桃花），导致情感和家庭生活不稳定。'],
    '47': ['八星:六煞(情感、人际),强,阳刚\n优点：外表富有魅力，善于交际，懂得变通，在处理人际关系方面非常圆融。异性缘极佳，适合在服务业、公关或与美相关的行业发展。\n缺点：情感丰富但脆弱，容易为情所困，情绪起伏大，易产生忧郁情绪。由于异性缘太好，容易陷入不健康的感情纠葛（偏桃花），导致情感和家庭生活不稳定。'],
    '38': ['八星:六煞(情感、人际),较弱，阴柔\n优点：外表富有魅力，善于交际，懂得变通，在处理人际关系方面非常圆融。异性缘极佳，适合在服务业、公关或与美相关的行业发展。\n缺点：情感丰富但脆弱，容易为情所困，情绪起伏大，易产生忧郁情绪。由于异性缘太好，容易陷入不健康的感情纠葛（偏桃花），导致情感和家庭生活不稳定。'],
    '83': ['八星:六煞(情感、人际),较弱，阴柔\n优点：外表富有魅力，善于交际，懂得变通，在处理人际关系方面非常圆融。异性缘极佳，适合在服务业、公关或与美相关的行业发展。\n缺点：情感丰富但脆弱，容易为情所困，情绪起伏大，易产生忧郁情绪。由于异性缘太好，容易陷入不健康的感情纠葛（偏桃花），导致情感和家庭生活不稳定。'],
    '92': ['八星:六煞(情感、人际),最弱，阴柔\n优点：外表富有魅力，善于交际，懂得变通，在处理人际关系方面非常圆融。异性缘极佳，适合在服务业、公关或与美相关的行业发展。\n缺点：情感丰富但脆弱，容易为情所困，情绪起伏大，易产生忧郁情绪。由于异性缘太好，容易陷入不健康的感情纠葛（偏桃花），导致情感和家庭生活不稳定。'],
    '29': ['八星:六煞(情感、人际),最弱，阴柔\n优点：外表富有魅力，善于交际，懂得变通，在处理人际关系方面非常圆融。异性缘极佳，适合在服务业、公关或与美相关的行业发展。\n缺点：情感丰富但脆弱，容易为情所困，情绪起伏大，易产生忧郁情绪。由于异性缘太好，容易陷入不健康的感情纠葛（偏桃花），导致情感和家庭生活不稳定。']
}

# 定义吉星和凶星
auspicious_stars = ['天医', '生气', '延年', '伏位']
inauspicious_stars = ['绝命', '五鬼', '祸害', '六煞']

# 定义星的五行属性
star_elements = {
    '天医': '土',
    '生气': '木',
    '延年': '金',
    '伏位': '土',
    '绝命': '金',
    '五鬼': '火',
    '祸害': '火',
    '六煞': '水'
}

# 特殊组合解释
special_combinations = {
    '绝命+天医': '投资生财：绝命代表冒险、冲动和投资，本身容易破财。但加上天医后，就意味着敢于投资并能获得回报，将"破财"的风险转化为"赚钱"的结果。',
    '祸害+天医': '口才生财：祸害代表口才和口舌是非。单独存在时易与人争吵，但加上天医后，就表示能通过口才、演说或沟通来赚钱。',
    '五鬼+天医': '智慧生财：五鬼代表智慧、才华和变动，也容易产生不稳定的想法。后面跟随天医，意味着能将这些独特的想法和策划能力转化为财富，获得"偏财"或"暗财"。',
    '六煞+天医': '人脉/魅力生财：六煞代表情感、人际关系和魅力。加上天医后，表示能将良好的人际关系和个人魅力转化为财富，尤其是在与人打交道的行业中。',
    '生气+天医': '贵人带财：生气代表贵人和好人缘，天医代表财富。这个组合意味着通过朋友、贵人的帮助轻松获得财富和机会，是典型的"有人帮着你赚钱"。',
    '天医+延年': '守财有道：天医带来财富，延年代表理财能力和责任心。这个组合是典型的"老板格局"，不仅会赚钱，更懂得如何管理和守护财富，让钱财持续增长。',
    '生气+延年': '乐在工作，贵人相助：生气让你对工作充满热情和乐观，延年则赋予你专业能力。这个组合意味着在工作中总有贵人相助，事业顺利，容易得到认可和升迁。',
    # 吉星之间的组合
    '天医+生气': '财富与人缘并重：天医带来财富，生气带来好人缘。这个组合意味着既有财运又有人缘，容易通过人际关系获得财富机会。',
    '生气+伏位': '稳定的人际关系：生气代表好人缘，伏位代表稳定和忍耐。这个组合意味着能建立稳定而持久的人际关系网络。',
    '天医+伏位': '稳定的财富：天医代表财富，伏位代表稳定。这个组合意味着财富来源稳定，能够持续获得收入。',
    '延年+天医': '专业理财：延年代表专业能力和责任心，天医代表财富。这个组合意味着具备专业的理财能力，能够有效管理和增值财富。',
    '延年+生气': '专业与人缘结合：延年代表专业能力，生气代表好人缘。这个组合意味着既有专业技能又有人际关系，事业发展顺利。',
    '延年+伏位': '专业稳定发展：延年代表专业能力，伏位代表稳定。这个组合意味着专业技能能够稳定发展，事业基础牢固。',
    '伏位+天医': '稳定财富积累：伏位代表稳定，天医代表财富。这个组合意味着能够稳定地积累财富，财务状况良好且持续。',
    '伏位+生气': '稳定人际关系：伏位代表稳定，生气代表好人缘。这个组合意味着人际关系稳定，能够建立持久的友谊和合作关系。',
    '伏位+延年': '稳健发展：伏位代表稳定，延年代表专业能力。这个组合意味着在稳定的环境中发展专业技能，事业稳步前进。'
}

def translate_input(input_str):
    """将输入字符串中的字母转换为对应数字，但保留0"""
    translated_str = ""
    for char in input_str:
        if char.isalpha():
            num = ord(char.upper()) - ord('A') + 1
            translated_str += str(num)
        else:
            translated_str += char
    return translated_str

def analyze_tail_numbers(translated_str):
    """分析尾号的吉凶"""
    results = []
    
    # 只取后六位进行分析
    if len(translated_str) > 6:
        tail_str = translated_str[-6:]
    else:
        tail_str = translated_str
    
    # 如果后两位包含0或5，则分析后三位
    last_two = tail_str[-2:] if len(tail_str) >= 2 else tail_str
    has_zero_or_five = '0' in last_two or '5' in last_two
    
    # 特别处理如409这样的情况：检查是否可以通过跳过0形成有效组合
    skip_zero_combination_found = False
    skip_zero_pair = None
    if len(tail_str) >= 3 and tail_str[-2] == '0' and tail_str[-1] in '123456789':
        # 检查前一位数字与最后一位数字组成的组合（跳过0）
        skip_zero_pair = tail_str[-3] + tail_str[-1]
        if skip_zero_pair in data:
            skip_zero_combination_found = True
    
    if (has_zero_or_five and len(tail_str) >= 3) or skip_zero_combination_found:
        # 分析后三位
        last_three = tail_str[-3:]
        analysis = f"尾号分析（后三位 {last_three}）：\n"
        
        # 分析每一位数字
        for i, digit in enumerate(last_three):
            position = ["倒数第三位", "倒数第二位", "最后一位"][i]
            if digit == '0':
                analysis += f"- {position}数字{digit}：代表'空'，意味着能量被削弱或隐藏。\n"
            elif digit == '5':
                analysis += f"- {position}数字{digit}：有'凸显'、'加强'的含义，可能加强相邻数字的能量。\n"
            else:
                # 检查是否能组成数字对
                if i < len(last_three) - 1:
                    pair = digit + last_three[i+1]
                    if pair in data:
                        star_info = data[pair][0]
                        first_line = star_info.split('\n')[0]
                        analysis += f"- {position}数字组合{pair}：{first_line}\n"
        
        # 特别处理跳过0的组合（如409中的49）
        if len(last_three) >= 3 and last_three[-2] == '0':
            skip_zero_pair = last_three[-3] + last_three[-1]
            if skip_zero_pair in data:
                star_info = data[skip_zero_pair][0]
                first_line = star_info.split('\n')[0]
                analysis += f"- 跳过中间0的数字组合{skip_zero_pair}：{first_line}（因0的存在，此为间接组合）\n"
        
        # 处理多个0和5的复杂情况
        # 检查是否有其他跳过数字的组合可能性
        if len(last_three) >= 3:
            # 检查第一位和第三位的组合（跳过中间位）
            first_last_pair = last_three[0] + last_three[2]
            if first_last_pair in data and (skip_zero_pair is None or first_last_pair != skip_zero_pair):
                star_info = data[first_last_pair][0]
                first_line = star_info.split('\n')[0]
                middle_digit = last_three[1]
                if middle_digit == '0':
                    analysis += f"- 跳过中间0的数字组合{first_last_pair}：{first_line}（因0的存在，此为间接组合）\n"
                elif middle_digit == '5':
                    analysis += f"- 跳过中间5的数字组合{first_last_pair}：{first_line}（因5的存在，此组合可能被加强）\n"
    else:
        # 分析后两位
        last_two = tail_str[-2:] if len(tail_str) >= 2 else tail_str
        analysis = f"尾号分析（后两位 {last_two}）：\n"
        
        if last_two in data:
            star_info = data[last_two][0]
            star_name = None
            for star in auspicious_stars + inauspicious_stars:
                if star in star_info:
                    star_name = star
                    break
            
            if star_name:
                if star_name in auspicious_stars:
                    analysis += f"- 吉星结尾：{star_name}，通常代表好的结果。"
                    if star_name == '天医':
                        analysis += "可能意味着财运好或感情顺利。\n"
                    elif star_name == '延年':
                        analysis += "代表有能力、能守财。\n"
                    elif star_name == '生气':
                        analysis += "代表人缘好，有贵人相助。\n"
                elif star_name in inauspicious_stars:
                    analysis += f"- 凶星结尾：{star_name}，通常被视为不吉利。"
                    if star_name == '绝命':
                        analysis += "可能导致投资失利、负债累累。\n"
                    elif star_name == '五鬼':
                        analysis += "可能带来意外、破财或感情突变。\n"
                    elif star_name == '祸害':
                        analysis += "容易招惹口舌是非。\n"
                    elif star_name == '六煞':
                        analysis += "情感丰富但容易为情所困。\n"
            else:
                first_line = star_info.split('\n')[0]
                analysis += f"- 数字组合{last_two}：{first_line}\n"
        elif '0' in last_two:
            # 特别处理包含0的情况
            analysis += "- 以'0'结尾：代表'空'，意味着最终可能一无所有，无论是财富、事业还是感情都容易成空。\n"
            # 检查0前面的数字是否能组成有效组合
            if len(last_two) == 2 and last_two[0] in '123456789':
                prefix_pair = last_two[0] + '0'
                if prefix_pair in data:
                    star_info = data[prefix_pair][0]
                    first_line = star_info.split('\n')[0]
                    analysis += f"- 数字组合{prefix_pair}：{first_line}（但因0的存在，能量可能被削弱）\n"
                else:
                    # 即使不是有效组合，也说明0对前面数字的影响
                    analysis += f"- 数字'{last_two[0]}'受后面的0影响，其能量可能被削弱或隐藏。\n"
        else:
            analysis += "- 未找到对应的八星能量信息。\n"
    
    results.append({
        'type': 'tail_analysis',
        'content': analysis
    })
    
    return results

def analyze_combination_pattern(translated_str):
    """分析数字组合模式并提供解释"""
    results = []
    
    # 只分析后六位
    if len(translated_str) > 6:
        analysis_str = translated_str[-6:]
    else:
        analysis_str = translated_str
    
    # 获取所有相邻数字对的信息
    pairs = []
    for i in range(len(analysis_str) - 1):
        comb = analysis_str[i] + analysis_str[i+1]
        if comb in data:
            pair_info = {
                'combination': comb,
                'content': data[comb][0],
                'is_auspicious': any(star in data[comb][0] for star in auspicious_stars),
                'is_inauspicious': any(star in data[comb][0] for star in inauspicious_stars),
                'position': i,  # 添加位置信息
                'first_digit': analysis_str[i],  # 第一个数字
                'second_digit': analysis_str[i+1]  # 第二个数字
            }
            pairs.append(pair_info)
    
    # 分析特殊组合
    for i in range(len(pairs) - 1):
        current_pair = pairs[i]
        next_pair = pairs[i+1]
        
        # 提取星名
        current_star = None
        next_star = None
        
        for star in auspicious_stars + inauspicious_stars:
            if star in current_pair['content']:
                current_star = star
            if star in next_pair['content']:
                next_star = star
        
        if current_star and next_star:
            combo_key = f"{current_star}+{next_star}"
            if combo_key in special_combinations:
                # 特殊组合应该是3位数：第一个数字对的第一个数字 + 第一个数字对 + 第二个数字对的第二个数字
                # 例如：41 + 13 -> 413
                special_combination_digits = current_pair['combination'] + next_pair['second_digit']
                results.append({
                    'type': 'special_combination',
                    'combination': special_combination_digits,
                    'first_pair': current_pair['combination'],
                    'second_pair': next_pair['combination'],
                    'explanation': special_combinations[combo_key]
                })
    
    # 分析0和5的影响（只分析后六位内的0和5）
    if '0' in analysis_str:
        zero_positions = [i for i, char in enumerate(analysis_str) if char == '0']
        for pos in zero_positions:
            results.append({
                'type': 'zero_effect',
                'position': pos,
                'explanation': '数字"0"代表"隐藏"、"空虚"或"能量被削弱"。它可能使相邻数字的能量被隐藏或削弱。'
            })
    
    if '5' in analysis_str:
        five_positions = [i for i, char in enumerate(analysis_str) if char == '5']
        for pos in five_positions:
            results.append({
                'type': 'five_effect',
                'position': pos,
                'explanation': '数字"5"有"凸显"、"加强"的含义，可能加强相邻数字的能量。'
            })
    
    return results

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/analyze', methods=['POST'])
def analyze():
    phone_number = request.form.get('phone_number')
    if not phone_number:
        return jsonify({'error': '请输入手机号码'})
    
    # 转换输入（保留0）
    translated_str = translate_input(phone_number)
    
    # 只分析后六位
    if len(translated_str) > 6:
        analysis_str = translated_str[-6:]
    else:
        analysis_str = translated_str
    
    # 找出所有相邻的数字对
    pairs = []
    for i in range(len(analysis_str) - 1):
        comb = analysis_str[i] + analysis_str[i+1]
        if comb in data:
            pairs.append({
                'combination': comb,
                'content': data[comb][0]
            })
    
    # 分析组合模式
    combination_results = analyze_combination_pattern(translated_str)
    
    # 分析尾号
    tail_results = analyze_tail_numbers(translated_str)
    
    # 准备返回结果
    results = []
    
    # 添加数字对分析
    for pair in pairs:
        # 提取星名和类型
        content_lines = pair['content'].split('\n')
        star_info = content_lines[0]
        star_details = '\n'.join(content_lines[1:])
        
        # 判断是否为吉星或凶星
        is_auspicious = any(star in star_info for star in auspicious_stars)
        is_inauspicious = any(star in star_info for star in inauspicious_stars)
        
        results.append({
            'type': 'pair',
            'combination': pair['combination'],
            'info': star_info,
            'details': star_details,
            'is_auspicious': is_auspicious,
            'is_inauspicious': is_inauspicious
        })
    
    # 添加组合模式分析
    results.extend(combination_results)
    
    # 添加尾号分析
    results.extend(tail_results)
    
    return jsonify({'results': results})

if __name__ == '__main__':
    app.run(debug=True)
